# Experiment 5: Subqueries and Views

## AIM
To study and implement subqueries and views.

## THEORY

### Subqueries
A subquery is a query inside another SQL query and is embedded in:
- WHERE clause
- HAVING clause
- FROM clause

**Types:**
- **Single-row subquery**:
  Sub queries can also return more than one value. Such results should be made use along with the operators in and any.
- **Multiple-row subquery**:
  Here more than one subquery is used. These multiple sub queries are combined by means of ‘and’ & ‘or’ keywords.
- **Correlated subquery**:
  A subquery is evaluated once for the entire parent statement whereas a correlated Sub query is evaluated once per row processed by the parent statement.

**Example:**
```sql
SELECT * FROM employees
WHERE salary > (SELECT AVG(salary) FROM employees);
```
### Views
A view is a virtual table based on the result of an SQL SELECT query.
**Create View:**
```sql
CREATE VIEW view_name AS
SELECT column1, column2 FROM table_name WHERE condition;
```
**Drop View:**
```sql
DROP VIEW view_name;
```

**Question 1**
--
rom the following tables write a SQL query to find salespeople who had more than one customer. Return salesman_id and name.

salesman table

name                 type
---------------   ---------------
salesman_id       numeric(5)
name                  varchar(30)
city                     varchar(15)
commission       decimal(5,2)

customer table

name              type
-----------       ----------
customer_id   int
cust_name     text
city                text
grade            int
salesman_id  int


<img width="177" height="123" alt="image" src="https://github.com/user-attachments/assets/00091f4a-2708-43f0-8e78-0360b8c14631" />



```sql

SELECT s.salesman_id, s.name
FROM salesman s
JOIN customer c ON s.salesman_id = c.salesman_id
GROUP BY s.salesman_id, s.name
HAVING COUNT(c.customer_id) > 1;

```

**Output:**

<img width="433" height="306" alt="image" src="https://github.com/user-attachments/assets/055c3bf7-6601-4360-91ab-a0d70c97114e" />


**Question 2**
---
Write a SQL query to Retrieve the medications with dosages equal to the highest dosage

Medications Table

<img width="671" height="174" alt="image" src="https://github.com/user-attachments/assets/cd8bfd01-76a4-4616-ab73-bb8ff9c27a9f" />


```sql

SELECT * 
FROM Medications
WHERE dosage = (SELECT MAX(dosage) FROM Medications);

```

**Output:**

<img width="661" height="244" alt="image" src="https://github.com/user-attachments/assets/a0776eea-4e5a-4f2b-b948-ab1973656146" />


**Question 3**
---
Write a SQL query to Retrieve the medications with dosages equal to the lowest dosage

Medications Table

<img width="690" height="165" alt="image" src="https://github.com/user-attachments/assets/9479f749-1612-47a5-9115-09a412b7a01f" />


```sql

SELECT medication_id AS medic, medication_name, dosage
FROM Medications
WHERE dosage = (SELECT MIN(dosage) FROM Medications);

```

**Output:**

<img width="656" height="248" alt="image" src="https://github.com/user-attachments/assets/ccde7dc8-b79a-4878-b6f2-25dcf1f9aa6f" />


**Question 4**
---
Write a SQL query that retrieves the names of students and their corresponding grades, where the grade is equal to the maximum grade achieved in each subject.

Sample table: GRADES

<img width="552" height="229" alt="image" src="https://github.com/user-attachments/assets/c5876872-6555-4b15-8536-b080c58e0582" />

```sql

SELECT student_name, grade
FROM GRADES g1
WHERE grade = (
    SELECT MAX(grade)
    FROM GRADES g2
    WHERE g2.subject = g1.subject
);

```

**Output:**

<img width="559" height="281" alt="image" src="https://github.com/user-attachments/assets/aa4dc2c8-546c-4209-b749-4be1df61efb6" />


**Question 5**
---
From the following tables write a SQL query to find all orders generated by New York-based salespeople. Return ord_no, purch_amt, ord_date, customer_id, salesman_id.

<img width="570" height="281" alt="image" src="https://github.com/user-attachments/assets/ad54f911-2885-41e7-ac1a-ca3f0ec83a8b" />


```sql

SELECT o.ord_no, o.purch_amt, o.ord_date, o.customer_id, o.salesman_id
FROM orders o
JOIN salesman s ON o.salesman_id = s.salesman_id
WHERE s.city = 'New York';

```

**Output:**

<img width="953" height="290" alt="image" src="https://github.com/user-attachments/assets/5f535401-4cc3-459e-bc07-b2dda2a44d1b" />


**Question 6**
---
Write a SQL query to retrieve all columns from the CUSTOMERS table for customers whose salary is EQUAL TO $1500.


Sample table: CUSTOMERS

ID          NAME        AGE         ADDRESS     SALARY
----------  ----------  ----------  ----------  ----------

1          Ramesh     32              Ahmedabad     2000
2          Khilan        25              Delhi                 1500
3          Kaushik      23              Kota                  2000
4          Chaitali       25             Mumbai            6500
5          Hardik        27              Bhopal              8500
6          Komal         22              Hyderabad       4500

7           Muffy          24              Indore            10000


```sql

SELECT *
FROM CUSTOMERS
WHERE SALARY = 1500;

```

**Output:**

<img width="934" height="192" alt="image" src="https://github.com/user-attachments/assets/ba7bad4d-dc84-410d-9521-876c7764c67f" />


**Question 7**
---
Write a query to display all the customers whose ID is the difference between the salesperson ID of Mc Lyon and 2001.

salesman table

name             type
---------------  ---------------
salesman_id      numeric(5)
name                 varchar(30)
city                    varchar(15)
commission       decimal(5,2)

customer table

name         type
-----------  ----------
customer_id  int
cust_name    text
city         text
grade        int
salesman_id  int


```sql

SELECT *
FROM customer
WHERE customer_id = (
    SELECT salesman_id - 2001
    FROM salesman
    WHERE name = 'Mc Lyon'
);

```

**Output:**

<img width="968" height="175" alt="image" src="https://github.com/user-attachments/assets/6920e6d7-a9ba-4f85-ad3a-9f4ab98c8c48" />


**Question 8**
---
Write a SQL query to List departments with names longer than the average length

Departments Table

<img width="691" height="121" alt="image" src="https://github.com/user-attachments/assets/bc09bed5-86a7-4bb5-9391-76546842c21f" />


```sql

SELECT department_id AS depar, department_name
FROM Departments
WHERE LENGTH(department_name) > (
    SELECT AVG(LENGTH(department_name))
    FROM Departments
);

```

**Output:**

<img width="420" height="246" alt="image" src="https://github.com/user-attachments/assets/1b9932c7-6982-4d9c-8ede-eefa3d93abfc" />


**Question 9**
---
Write a SQL query to retrieve all columns from the CUSTOMERS table for customers whose salary is greater than $4500.

Sample table: CUSTOMERS

ID          NAME        AGE         ADDRESS     SALARY
----------  ----------  ----------  ----------  ----------

1          Ramesh     32              Ahmedabad     2000
2          Khilan        25              Delhi                 1500
3          Kaushik      23              Kota                  2000
4          Chaitali       25             Mumbai            6500
5          Hardik        27              Bhopal              8500
6          Komal         22              Hyderabad       4500

7           Muffy          24              Indore            10000


```sql

SELECT *
FROM CUSTOMERS
WHERE SALARY > 4500;

```

**Output:**

<img width="935" height="281" alt="image" src="https://github.com/user-attachments/assets/fa54f3ed-6170-4c37-be2e-e02081917e0d" />


**Question 10**
---
From the following tables, write a SQL query to determine the commission of the salespeople in Paris. Return commission.

salesman table

name             type
---------------  ---------------
salesman_id      numeric(5)
name                 varchar(30)
city                    varchar(15)
commission       decimal(5,2)

customer table

name         type
-----------  ----------
customer_id  int
cust_name    text
city         text
grade        int
salesman_id  int


```sql

SELECT MAX(commission) AS commission
FROM salesman
WHERE city = 'Paris';


```


<img width="563" height="272" alt="image" src="https://github.com/user-attachments/assets/4ee4f35f-9998-4542-9c6a-066581251ff3" />





## RESULT
Thus, the SQL queries to implement subqueries and views have been executed successfully.
